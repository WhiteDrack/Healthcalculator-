<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Haircut Advisor - Stable Version</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-core"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-converter"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-webgl"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/face-landmarks-detection"></script>

    <style>
        body { font-family: sans-serif; background: #000; color: white; text-align: center; margin: 0; padding: 10px; }
        #video-container { position: relative; width: 100%; max-width: 360px; margin: auto; border: 2px solid #00d1b2; border-radius: 20px; overflow: hidden; height: 450px; background: #111; }
        video { width: 100%; height: 100%; object-fit: cover; }
        .btn { background: #00d1b2; color: #000; border: none; padding: 15px 40px; font-weight: bold; border-radius: 30px; margin: 20px 0; cursor: pointer; font-size: 16px; }
        #result-box { background: #1a1a1a; padding: 15px; border-radius: 15px; margin: 10px auto; width: 90%; border: 1px solid #333; }
        .label { color: #888; font-size: 12px; letter-spacing: 1px; }
        .value { color: #00d1b2; font-size: 20px; font-weight: bold; display: block; margin: 5px 0 15px 0; }
        #loader { color: #ffdd57; font-size: 14px; margin-top: 10px; }
    </style>
</head>
<body>

    <h2>✂️ AI Haircut Advisor</h2>

    <div id="video-container">
        <video id="video" playsinline autoplay muted></video>
    </div>

    <button id="startBtn" class="btn">Start Camera</button>
    <div id="loader">Pehle upar wala button dabayein</div>

    <div id="result-box">
        <span class="label">FACE SHAPE</span>
        <span id="face-shape" class="value">Ready to Scan</span>
        
        <span class="label">BEST HAIRCUT</span>
        <span id="haircut" class="value">-</span>
    </div>

    <script>
        const video = document.getElementById('video');
        const startBtn = document.getElementById('startBtn');
        const loader = document.getElementById('loader');

        let detector;

        async function setupAI() {
            startBtn.disabled = true;
            loader.innerText = "AI System loading... (Thoda intezar karein)";
            
            try {
                const model = faceLandmarksDetection.SupportedModels.MediaPipeFaceMesh;
                const detectorConfig = { runtime: 'mediapipe', solutionPath: 'https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh' };
                detector = await faceLandmarksDetection.createDetector(model, detectorConfig);
                
                startCamera();
            } catch (err) {
                loader.innerText = "Error: System load nahi ho saka. Refresh karein.";
                console.error(err);
            }
        }

        async function startCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: "user" } 
                });
                video.srcObject = stream;
                loader.innerText = "AI Scanning Active!";
                renderPrediction();
            } catch (err) {
                loader.innerText = "Camera access nahi mila.";
            }
        }

        async function renderPrediction() {
            const faces = await detector.estimateFaces(video);
            
            if (faces.length > 0) {
                const keypoints = faces[0].keypoints;
                
                // Measuring distances for face shape
                const leftJaw = keypoints[234];
                const rightJaw = keypoints[454];
                const chin = keypoints[152];
                const topHead = keypoints[10];

                const faceWidth = Math.sqrt(Math.pow(rightJaw.x - leftJaw.x, 2) + Math.pow(rightJaw.y - leftJaw.y, 2));
                const faceHeight = Math.sqrt(Math.pow(chin.x - topHead.x, 2) + Math.pow(chin.y - topHead.y, 2));
                
                const ratio = faceHeight / faceWidth;

                let shape = "";
                let style = "";

                if (ratio > 1.5) {
                    shape = "Oval (Lamba Chehra)";
                    style = "Side Part / Pompadour / Long Fringe";
                } else if (ratio < 1.3) {
                    shape = "Round (Gol Chehra)";
                    style = "High Fade / Spiky / Textured Quiff";
                } else {
                    shape = "Square (Chaukore Chehra)";
                    style = "Buzz Cut / Crew Cut / Slicked Back";
                }

                document.getElementById('face-shape').innerText = shape;
                document.getElementById('haircut').innerText = style;
            }

            window.requestAnimationFrame(renderPrediction);
        }

        startBtn.addEventListener('click', setupAI);
    </script>
</body>
</html>

