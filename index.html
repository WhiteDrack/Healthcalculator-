<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI Haircut Advisor - Fixed</title>
    <script src="https://cdn.jsdelivr.net/npm/@vladmandic/face-api/dist/face-api.js"></script>
    <style>
        body { font-family: sans-serif; background: #121212; color: white; text-align: center; margin: 0; padding: 10px; }
        #container { position: relative; width: 100%; max-width: 350px; margin: auto; border: 2px solid #00d1b2; border-radius: 15px; overflow: hidden; height: 400px; background: #000; }
        video { width: 100%; height: 100%; object-fit: cover; }
        canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        .btn { background: #00d1b2; color: black; border: none; padding: 15px 30px; font-weight: bold; border-radius: 30px; margin: 20px 0; cursor: pointer; width: 80%; }
        #result { background: #1e1e1e; padding: 15px; border-radius: 10px; margin: 10px auto; width: 90%; }
        .info { color: #888; font-size: 12px; margin-bottom: 5px; }
        .val { color: #00d1b2; font-size: 18px; font-weight: bold; display: block; }
    </style>
</head>
<body>

    <h2>✂️ AI Haircut Advisor</h2>

    <div id="container">
        <video id="video" autoplay muted playsinline></video>
    </div>

    <button id="startBtn" class="btn">Start Scan</button>
    <p id="status" style="color: #ffdd57; font-size: 14px;">Pehle 'Start Scan' dabayein...</p>

    <div id="result">
        <div class="info">FACE SHAPE</div>
        <span id="face-shape" class="val">Scanning...</span>
        <hr style="border: 0.1px solid #333; margin: 10px 0;">
        <div class="info">BEST HAIRCUT</div>
        <span id="haircut" class="val">-</span>
    </div>

    <script>
        const video = document.getElementById('video');
        const status = document.getElementById('status');
        const startBtn = document.getElementById('startBtn');

        async function startApp() {
            startBtn.disabled = true;
            status.innerText = "Models load ho rahe hain (2-5 sec)...";

            try {
                // Models ko directly GitHub se load kar rahe hain bina kisi error ke
                const MODEL_URL = 'https://cdn.jsdelivr.net/gh/justadudewhohacks/face-api.js@master/weights/';
                
                await faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL);
                await faceapi.nets.faceLandmarks68Net.loadFromUri(MODEL_URL);

                status.innerText = "Camera khul raha hai...";
                
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: "user" } 
                });
                video.srcObject = stream;

                video.onplay = () => {
                    status.innerText = "AI active hai! Chehra samne layein.";
                    detect();
                };
            } catch (err) {
                status.innerText = "Error: " + err.message;
                startBtn.disabled = false;
            }
        }

        async function detect() {
            const canvas = faceapi.createCanvasFromMedia(video);
            document.getElementById('container').append(canvas);
            const displaySize = { width: video.offsetWidth, height: video.offsetHeight };
            faceapi.matchDimensions(canvas, displaySize);

            setInterval(async () => {
                const detection = await faceapi.detectSingleFace(video, new faceapi.TinyFaceDetectorOptions()).withFaceLandmarks();
                
                if (detection) {
                    const landmarks = detection.landmarks;
                    const jaw = landmarks.getJawline();
                    const topFace = landmarks.getPositions()[27]; // Nose bridge point
                    
                    const width = Math.abs(jaw[0].x - jaw[16].x);
                    const height = Math.abs(jaw[8].y - topFace.y);
                    const ratio = height / width;

                    let shape = "Detecting...";
                    let style = "Calculating...";

                    if (ratio > 1.55) { shape = "Oval (Andakar)"; style = "Side Part / Pompadour"; }
                    else if (ratio < 1.35) { shape = "Round (Gol)"; style = "High Fade / Spiky"; }
                    else { shape = "Square (Chaukore)"; style = "Crew Cut / Buzz Cut"; }

                    document.getElementById('face-shape').innerText = shape;
                    document.getElementById('haircut').innerText = style;
                }
            }, 800);
        }

        startBtn.addEventListener('click', startApp);
    </script>
</body>
</html>
