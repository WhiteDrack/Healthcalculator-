
<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>White Drack - AI Style Master Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/face-landmarks-detection"></script>
    
    <style>
        :root { --neon: #00f2fe; --dark: #0f172a; --card: rgba(255, 255, 255, 0.05); }
        body { font-family: 'Poppins', sans-serif; background: var(--dark); color: white; margin: 0; padding: 15px; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        .container { width: 100%; max-width: 420px; }
        
        /* Video Section */
        #preview-wrap { width: 100%; height: 320px; background: #000; border-radius: 25px; position: relative; border: 2px solid var(--neon); overflow: hidden; margin-bottom: 10px; }
        video { width: 100%; height: 100%; object-fit: cover; }
        
        /* Chat History Box (Your Style) */
        #chat-window { background: var(--card); height: 180px; overflow-y: auto; border-radius: 20px; padding: 15px; border: 1px solid rgba(255,255,255,0.1); margin-bottom: 15px; scroll-behavior: smooth; }
        .msg { margin-bottom: 12px; font-size: 14px; line-height: 1.5; padding: 10px; border-radius: 12px; }
        .bot-msg { background: rgba(0, 242, 254, 0.1); border-left: 4px solid var(--neon); color: #e2e8f0; }
        .user-msg { background: rgba(255, 255, 255, 0.1); text-align: right; margin-left: 20%; color: var(--neon); }

        /* Status & Stats */
        .stats-row { display: flex; justify-content: space-between; padding: 0 10px 15px; }
        .stat-item { text-align: center; }
        .stat-item small { color: #888; text-transform: uppercase; font-size: 10px; letter-spacing: 1px; }
        .stat-item b { display: block; color: var(--neon); font-size: 16px; }

        /* Controls */
        .btn-main { background: var(--neon); color: #000; border: none; padding: 14px; border-radius: 15px; width: 100%; font-weight: bold; cursor: pointer; font-size: 16px; margin-bottom: 15px; box-shadow: 0 4px 15px rgba(0, 242, 254, 0.3); }
        .mic-btn { width: 70px; height: 70px; border-radius: 50%; background: linear-gradient(135deg, #ff416c, #ff4b2b); border: none; color: white; font-size: 28px; cursor: pointer; display: block; margin: auto; transition: 0.3s; box-shadow: 0 0 20px rgba(255, 65, 108, 0.4); }
        .mic-active { animation: pulse 1s infinite; }
        @keyframes pulse { 0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 65, 108, 0.7); } 70% { transform: scale(1.1); box-shadow: 0 0 0 15px rgba(255, 65, 108, 0); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

<div class="container">
    <header style="text-align: center; margin-bottom: 15px;">
        <h1 style="color: var(--neon); margin: 0; font-size: 1.6rem; letter-spacing: 1px;">‚úÇÔ∏è AI STYLE EXPERT</h1>
    </header>

    <div id="preview-wrap">
        <video id="video" autoplay playsinline muted></video>
    </div>

    <div class="stats-row">
        <div class="stat-item">
            <small>Shape</small>
            <b id="face-shape">Waiting...</b>
        </div>
        <div class="stat-item">
            <small>Suggestion</small>
            <b id="haircut">---</b>
        </div>
    </div>

    <div id="chat-window">
        <div class="msg bot-msg">Hello! Main <b>White Drack AI</b> hoon. 'START AI SCANNER' dabayein aur apna chehra dikhayein.</div>
    </div>

    <button class="btn-main" onclick="startApp()">üì∑ START AI SCANNER</button>
    <button id="micBtn" class="mic-btn" onclick="startVoice()">üé§</button>
    <p style="text-align:center; font-size: 12px; color: #555; margin-top: 10px;">Powered by OpenRouter AI</p>
</div>

<script>
    // Aapki Working API Key
    const API_KEY = "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";
    const video = document.getElementById('video');
    const chatWindow = document.getElementById('chat-window');
    const micBtn = document.getElementById('micBtn');
    
    // Conversation History (Your Chatbot Logic)
    let conversationHistory = [];
    let detector;
    let currentFaceShape = "Unknown";
    let currentHaircut = "None";

    async function initAI() {
        try {
            const model = faceLandmarksDetection.SupportedModels.MediaPipeFaceMesh;
            detector = await faceLandmarksDetection.createDetector(model, {
                runtime: 'mediapipe',
                solutionPath: 'https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh'
            });
        } catch (e) { console.error("Model Load Error"); }
    }
    initAI();

    async function startApp() {
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } });
            video.srcObject = stream;
            appendMessage('bot', "Camera active! Main scan kar raha hoon...");
            setInterval(scanFace, 1000);
        } catch (e) { appendMessage('bot', "Error: Camera access nahi mila."); }
    }

    async function scanFace() {
        if (!detector) return;
        const faces = await detector.estimateFaces(video);
        if (faces.length > 0) {
            const kp = faces[0].keypoints;
            const r = Math.abs(kp[152].y - kp[10].y) / Math.abs(kp[454].x - kp[234].x);
            
            if (r > 1.55) { currentFaceShape = "Oval"; currentHaircut = "Side Part Pompadour"; }
            else if (r < 1.35) { currentFaceShape = "Round"; currentHaircut = "High Fade Spiky"; }
            else { currentFaceShape = "Square"; currentHaircut = "Crew Cut"; }

            document.getElementById('face-shape').innerText = currentFaceShape;
            document.getElementById('haircut').innerText = currentHaircut;
        }
    }

    // --- Voice & OpenRouter Connection ---
    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = 'hi-IN';

    function startVoice() {
        recognition.start();
        micBtn.classList.add('mic-active');
    }

    recognition.onresult = async (event) => {
        micBtn.classList.remove('mic-active');
        const userText = event.results[0][0].transcript;
        appendMessage('user', userText);
        
        // Add to history
        conversationHistory.push({ role: 'user', content: userText });
        appendMessage('bot', "Thinking...");

        try {
            const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                method: "POST",
                headers: {
                    "Authorization": `Bearer ${API_KEY}`,
                    "Content-Type": "application/json",
                    "HTTP-Referer": window.location.origin, // Safety for OpenRouter
                },
                body: JSON.stringify({
                    "model": "google/gemini-2.0-flash-exp:free", // Free & Fast model
                    "messages": [
                        { "role": "system", "content": `You are 'White Drack AI', a celebrity barber expert. The user has a ${currentFaceShape} face shape. Your suggestion is ${currentHaircut}. Answer in Hindi professionally.` },
                        ...conversationHistory
                    ]
                })
            });

            const data = await response.json();
            const aiReply = data.choices[0].message.content;
            
            // Replace "Thinking..." with real reply
            chatWindow.lastElementChild.remove();
            appendMessage('bot', aiReply);
            conversationHistory.push({ role: 'assistant', content: aiReply });
            
            // Text to Speech
            const utter = new SpeechSynthesisUtterance(aiReply);
            utter.lang = 'hi-IN';
            window.speechSynthesis.speak(utter);

        } catch (err) {
            chatWindow.lastElementChild.remove();
            appendMessage('bot', "API Connection Error. Internet ya Key check karein.");
            console.error(err);
        }
    };

    function appendMessage(sender, text) {
        const div = document.createElement('div');
        div.className = `msg ${sender}-msg`;
        div.innerHTML = text;
        chatWindow.appendChild(div);
        chatWindow.scrollTop = chatWindow.scrollHeight;
    }
</script>
</body>
</html>
