<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>White Drack - AI Style Master</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/face-landmarks-detection"></script>
    
    <style>
        :root { --neon: #00f2fe; --dark: #0f172a; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--dark); color: white; margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center; }
        .app-container { width: 100%; max-width: 450px; }
        
        /* Video Section */
        #video-wrap { width: 100%; height: 300px; background: #000; border-radius: 20px; position: relative; border: 2px solid var(--neon); overflow: hidden; margin-bottom: 15px; }
        video { width: 100%; height: 100%; object-fit: cover; }
        
        /* Chat History Box */
        #chat-window { background: rgba(255,255,255,0.05); height: 200px; overflow-y: auto; border-radius: 15px; padding: 10px; margin-bottom: 10px; border: 1px solid rgba(255,255,255,0.1); font-size: 14px; }
        .msg { margin-bottom: 10px; padding: 8px 12px; border-radius: 10px; line-height: 1.4; }
        .bot-msg { background: rgba(0, 242, 254, 0.1); border-left: 3px solid var(--neon); text-align: left; }
        .user-msg { background: rgba(255,255,255,0.1); text-align: right; margin-left: 20%; }

        /* Controls */
        .btn-group { display: flex; gap: 10px; margin-bottom: 10px; }
        .btn { flex: 1; background: var(--neon); color: #000; border: none; padding: 12px; border-radius: 10px; font-weight: bold; cursor: pointer; }
        .mic-btn { width: 60px; height: 60px; border-radius: 50%; background: #ff416c; border: none; color: white; font-size: 24px; cursor: pointer; display: block; margin: auto; }
        .mic-active { animation: pulse 1s infinite; box-shadow: 0 0 15px #ff416c; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

<div class="app-container">
    <h2 style="color:var(--neon); text-align:center;">WHITE DRACK STYLE AI</h2>

    <div id="video-wrap">
        <video id="video" autoplay playsinline muted></video>
    </div>

    <div id="chat-window">
        <div class="msg bot-msg">Hello! Main White Drack AI hoon. 'Start Scanner' dabayein taaki main aapka chehra dekh sakun.</div>
    </div>

    <div class="btn-group">
        <button class="btn" onclick="startSystem()">ðŸ“· START SCANNER</button>
    </div>

    <button id="micBtn" class="mic-btn" onclick="startVoice()">ðŸŽ¤</button>
    <p style="text-align:center; font-size: 11px; color: #888; margin-top: 10px;">Face Shape: <span id="face-display">Scanning...</span></p>
</div>

<script>
    const API_KEY = "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";
    const video = document.getElementById('video');
    const chatWindow = document.getElementById('chat-window');
    const micBtn = document.getElementById('micBtn');
    
    // Aapka history logic
    let conversationHistory = [
        { role: 'assistant', content: "Namaste! Main aapka AI barber hoon. Poochiye aapko kaisi cutting chahiye?" }
    ];

    let detector;
    let currentFaceShape = "Unknown";

    // AI Detector Load Karein
    async function initAI() {
        try {
            const model = faceLandmarksDetection.SupportedModels.MediaPipeFaceMesh;
            detector = await faceLandmarksDetection.createDetector(model, {
                runtime: 'mediapipe',
                solutionPath: 'https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh'
            });
        } catch (e) { appendMessage('bot', "System load hone mein dikkat hai. Refresh karein."); }
    }
    initAI();

    async function startSystem() {
        const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } });
        video.srcObject = stream;
        setInterval(scanFace, 1000);
    }

    async function scanFace() {
        if (!detector) return;
        const faces = await detector.estimateFaces(video);
        if (faces.length > 0) {
            const kp = faces[0].keypoints;
            const r = Math.abs(kp[152].y - kp[10].y) / Math.abs(kp[454].x - kp[234].x);
            currentFaceShape = r > 1.5 ? "Oval" : (r < 1.3 ? "Round" : "Square");
            document.getElementById('face-display').innerText = currentFaceShape;
        }
    }

    // Voice & Chat Logic
    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = 'hi-IN';

    function startVoice() {
        recognition.start();
        micBtn.classList.add('mic-active');
    }

    recognition.onresult = async (event) => {
        micBtn.classList.remove('mic-active');
        const userText = event.results[0][0].transcript;
        appendMessage('user', userText);
        
        // Add to history
        conversationHistory.push({ role: 'user', content: userText });

        // Call API
        try {
            const res = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                method: "POST",
                headers: {
                    "Authorization": `Bearer ${API_KEY}`,
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    model: "openai/gpt-3.5-turbo",
                    messages: [
                        { role: 'system', content: `You are a professional barber. User's face is ${currentFaceShape}. Help them with styling. Answer in Hindi.` },
                        ...conversationHistory
                    ]
                })
            });
            const data = await res.json();
            const reply = data.choices[0].message.content;
            
            appendMessage('bot', reply);
            conversationHistory.push({ role: 'assistant', content: reply });
            speak(reply);
        } catch (e) { appendMessage('bot', "Maaf kijiye, connection fail ho gaya."); }
    };

    function appendMessage(sender, text) {
        const div = document.createElement('div');
        div.className = `msg ${sender}-msg`;
        div.innerText = text;
        chatWindow.appendChild(div);
        chatWindow.scrollTop = chatWindow.scrollHeight;
    }

    function speak(text) {
        const synth = window.speechSynthesis;
        const utter = new SpeechSynthesisUtterance(text);
        utter.lang = 'hi-IN';
        synth.speak(utter);
    }
</script>
</body>
</html>
